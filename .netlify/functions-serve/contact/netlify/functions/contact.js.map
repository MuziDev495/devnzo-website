{
  "version": 3,
  "sources": ["../../../../../../../Users/muzi/Devnzo web/devnzo-fetch-companion/netlify/functions/contact.ts", "../../../../../../../Users/muzi/Devnzo web/devnzo-fetch-companion/netlify/functions/utils/ses.ts"],
  "sourceRoot": "/private/var/folders/jz/v827s81945j2llcsgdmht72m0000gn/T/tmp-60104-z1LvUI9SI4Kh",
  "sourcesContent": ["import { Handler } from '@netlify/functions';\nimport { sendContactEmail } from './utils/ses';\n\nexport const handler: Handler = async (event) => {\n    // CORS headers\n    const headers = {\n        'Access-Control-Allow-Origin': '*',\n        'Access-Control-Allow-Headers': 'Content-Type',\n        'Access-Control-Allow-Methods': 'POST, OPTIONS',\n        'Content-Type': 'application/json',\n    };\n\n    // Handle preflight\n    if (event.httpMethod === 'OPTIONS') {\n        return { statusCode: 204, headers, body: '' };\n    }\n\n    // Validate POST method\n    if (event.httpMethod !== 'POST') {\n        return {\n            statusCode: 405,\n            headers,\n            body: JSON.stringify({ error: 'Method not allowed' }),\n        };\n    }\n\n    try {\n        console.log('\uD83D\uDCE7 Contact form submission received');\n        const data = JSON.parse(event.body || '{}');\n        console.log('\uD83D\uDCDD Form data:', { name: data.name, email: data.email, subject: data.subject });\n\n        // Validate required fields\n        const { name, email, subject, message } = data;\n        if (!name || !email || !subject || !message) {\n            console.log('\u274C Missing required fields');\n            return {\n                statusCode: 400,\n                headers,\n                body: JSON.stringify({ error: 'Missing required fields' }),\n            };\n        }\n\n        // Basic email validation\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n        if (!emailRegex.test(email)) {\n            console.log('\u274C Invalid email format');\n            return {\n                statusCode: 400,\n                headers,\n                body: JSON.stringify({ error: 'Invalid email address' }),\n            };\n        }\n\n        // Send email\n        console.log('\uD83D\uDCE4 Attempting to send email via AWS SES...');\n        const result = await sendContactEmail(data);\n        console.log('\uD83D\uDCEC SES result:', result);\n\n        if (result.success) {\n            console.log('\u2705 Email sent successfully!');\n            return {\n                statusCode: 200,\n                headers,\n                body: JSON.stringify({\n                    success: true,\n                    message: 'Email sent successfully',\n                    messageId: result.messageId,\n                }),\n            };\n        } else {\n            console.log('\u274C Failed to send email:', result.error);\n            return {\n                statusCode: 500,\n                headers,\n                body: JSON.stringify({\n                    success: false,\n                    error: result.error || 'Failed to send email',\n                }),\n            };\n        }\n    } catch (error) {\n        console.error('\u274C Contact form error:', error);\n        const errorMessage = error instanceof Error ? error.message : 'Internal server error';\n        console.error('Error details:', errorMessage);\n\n        return {\n            statusCode: 500,\n            headers,\n            body: JSON.stringify({\n                error: 'Internal server error',\n                details: errorMessage\n            }),\n        };\n    }\n};\n", "import { SESClient, SendEmailCommand } from '@aws-sdk/client-ses';\n\n// Initialize SES client\nconst sesClient = new SESClient({\n  region: process.env.AWS_REGION || 'us-east-1',\n  credentials: {\n    accessKeyId: process.env.AWS_ACCESS_KEY_ID!,\n    secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY!,\n  },\n});\n\ninterface ContactFormData {\n  name: string;\n  email: string;\n  phone?: string;\n  company?: string;\n  subject: string;\n  message: string;\n}\n\n// Generate HTML email template for contact form\nfunction generateContactEmailHTML(data: ContactFormData): string {\n  return `\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <meta charset=\"UTF-8\">\n      <style>\n        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n        .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 8px 8px 0 0; }\n        .content { background: #f9f9f9; padding: 30px; border-radius: 0 0 8px 8px; }\n        .field { margin-bottom: 20px; }\n        .label { font-weight: bold; color: #667eea; margin-bottom: 5px; }\n        .value { background: white; padding: 12px; border-radius: 4px; border-left: 3px solid #667eea; }\n        .footer { text-align: center; margin-top: 20px; color: #666; font-size: 12px; }\n      </style>\n    </head>\n    <body>\n      <div class=\"container\">\n        <div class=\"header\">\n          <h1>\uD83D\uDCE7 New Contact Form Submission</h1>\n          <p>Devnzo Support</p>\n        </div>\n        <div class=\"content\">\n          <div class=\"field\">\n            <div class=\"label\">\uD83D\uDC64 Name:</div>\n            <div class=\"value\">${data.name}</div>\n          </div>\n          <div class=\"field\">\n            <div class=\"label\">\uD83D\uDCE7 Email:</div>\n            <div class=\"value\"><a href=\"mailto:${data.email}\">${data.email}</a></div>\n          </div>\n          ${data.phone ? `\n          <div class=\"field\">\n            <div class=\"label\">\uD83D\uDCF1 Phone:</div>\n            <div class=\"value\">${data.phone}</div>\n          </div>\n          ` : ''}\n          ${data.company ? `\n          <div class=\"field\">\n            <div class=\"label\">\uD83C\uDFE2 Company:</div>\n            <div class=\"value\">${data.company}</div>\n          </div>\n          ` : ''}\n          <div class=\"field\">\n            <div class=\"label\">\uD83D\uDCDD Subject:</div>\n            <div class=\"value\">${data.subject}</div>\n          </div>\n          <div class=\"field\">\n            <div class=\"label\">\uD83D\uDCAC Message:</div>\n            <div class=\"value\">${data.message.replace(/\\n/g, '<br>')}</div>\n          </div>\n          <div class=\"footer\">\n            <p>Sent via Devnzo Contact Form \u2022 ${new Date().toLocaleString()}</p>\n          </div>\n        </div>\n      </div>\n    </body>\n    </html>\n  `;\n}\n\n// Send contact form email\nexport async function sendContactEmail(data: ContactFormData) {\n  try {\n    // Validate environment variables\n    if (!process.env.AWS_ACCESS_KEY_ID || !process.env.AWS_SECRET_ACCESS_KEY || !process.env.AWS_REGION) {\n      throw new Error('AWS SES environment variables are required');\n    }\n\n    if (!process.env.SES_FROM_EMAIL) {\n      throw new Error('SES_FROM_EMAIL environment variable is required');\n    }\n\n    const htmlContent = generateContactEmailHTML(data);\n\n    console.log('\uD83D\uDCE7 Preparing to send email...');\n    console.log('From:', process.env.SES_FROM_EMAIL);\n    console.log('To:', process.env.SES_FROM_EMAIL);\n    console.log('Reply-To:', data.email);\n\n    const params = {\n      Destination: {\n        ToAddresses: [process.env.SES_FROM_EMAIL], // Send to verified email\n      },\n      Message: {\n        Body: {\n          Html: {\n            Charset: 'UTF-8',\n            Data: htmlContent,\n          },\n        },\n        Subject: {\n          Charset: 'UTF-8',\n          Data: `New Contact: ${data.subject}`,\n        },\n      },\n      Source: process.env.SES_FROM_EMAIL,\n      ReplyToAddresses: [data.email], // Allow direct reply to customer\n    };\n\n    console.log('\uD83D\uDCE4 Sending email via AWS SES...');\n    const command = new SendEmailCommand(params);\n    const response = await sesClient.send(command);\n    console.log('\uD83D\uDCEC AWS SES Response received:', response);\n\n    console.log('\u2705 Contact form email sent successfully');\n    console.log('\uD83D\uDCE7 From:', data.email);\n    console.log('\uD83D\uDCEC Subject:', data.subject);\n    console.log('\uD83C\uDD94 Message ID:', response.MessageId);\n\n    return {\n      success: true,\n      messageId: response.MessageId,\n    };\n  } catch (error) {\n    console.error('\u274C AWS SES email sending failed:', error);\n    console.error('Error type:', typeof error);\n    console.error('Error name:', error instanceof Error ? error.name : 'unknown');\n    console.error('Error message:', error instanceof Error ? error.message : String(error));\n    console.error('Full error object:', JSON.stringify(error, null, 2));\n\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Unknown error',\n    };\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
